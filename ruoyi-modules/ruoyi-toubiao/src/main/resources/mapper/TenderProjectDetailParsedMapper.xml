<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.dromara.toubiao.mapper.TenderProjectDetailParsedMapper">

    <resultMap id="BaseResultMap" type="org.dromara.toubiao.domain.TenderProjectDetailParsed">
        <id column="id" property="id" />
        <result column="infoid" property="infoid" />
        <result column="info_url" property="infoUrl" />
        <result column="prono" property="prono" />
        <result column="proname" property="proname" />
        <result column="budget_amount" property="budgetAmount" />
        <result column="tender_method" property="tenderMethod" />
        <result column="area" property="area" />
        <result column="publish_time" property="publishTime" />
        <result column="doc_start_time" property="docStartTime" />
        <result column="doc_end_time" property="docEndTime" />
        <result column="bidding_deadline" property="biddingDeadline" />
        <result column="kaibiaodate" property="kaibiaodate" />
        <result column="changdi" property="changdi" />
        <result column="purchaser" property="purchaser" />
        <result column="purchaser_address" property="purchaserAddress" />
        <result column="purchaser_phone" property="purchaserPhone" />
        <result column="agent_company" property="agentCompany" />
        <result column="agent_address" property="agentAddress" />
        <result column="agent_phone" property="agentPhone" />
        <result column="project_contact" property="projectContact" />
        <result column="project_phone" property="projectPhone" />
        <result column="section_project_need" property="sectionProjectNeed" />
        <result column="section_project_overview" property="sectionProjectOverview" />
        <result column="section_basic_info" property="sectionBasicInfo" />
        <result column="section_qualification" property="sectionQualification" />
        <result column="section_doc_acquisition" property="sectionDocAcquisition" />
        <result column="section_bidding_schedule" property="sectionBiddingSchedule" />
        <result column="section_announcement_period" property="sectionAnnouncementPeriod" />
        <result column="section_other_matters" property="sectionOtherMatters" />
        <result column="section_contact" property="sectionContact" />
        <result column="parse_status" property="parseStatus" />
        <result column="parse_time" property="parseTime" />
        <result column="parse_retry_count" property="parseRetryCount" />
        <result column="parse_error_msg" property="parseErrorMsg" />
        <result column="is_ai_classified" property="isAiClassified" />
        <result column="ai_classify_time" property="aiClassifyTime" />
        <result column="category_code" property="categoryCode" />
        <result column="created_time" property="createdTime" />
        <result column="updated_time" property="updatedTime" />
    </resultMap>

    <!-- 查询所有数据 -->
    <select id="selectAll" resultMap="BaseResultMap">
        SELECT * FROM tender_project_detail_parsed
        ORDER BY created_time DESC
    </select>

    <!-- 分页查询 -->
    <select id="selectPageList" resultMap="BaseResultMap">
        SELECT * FROM tender_project_detail_parsed
        <where>
            <if test="position != null and position != ''">
                AND area LIKE CONCAT('%', #{position}, '%')
            </if>
            <if test="title != null and title != ''">
                AND proname LIKE CONCAT('%', #{title}, '%')
            </if>
        </where>
        ORDER BY created_time DESC
    </select>

    <!-- 根据ID查询 -->
    <select id="selectById" resultMap="BaseResultMap">
        SELECT * FROM tender_project_detail_parsed
        WHERE id = #{id}
    </select>

    <!-- CategoryMessage ResultMap -->
    <resultMap id="CategoryMessageResultMap" type="org.dromara.toubiao.domain.CategoryMessage">
        <id column="id" property="id" />
        <result column="proname" property="proname" />
        <result column="section_project_need" property="sectionProjectNeed" />
        <result column="section_project_overview" property="sectionProjectOverview" />
    </resultMap>

    <!-- 查询分类信息 -->
    <select id="selectCategoryMessage" resultMap="CategoryMessageResultMap">
        SELECT
            id,
            proname,
            section_project_need,
            section_project_overview
        FROM tender_project_detail_parsed
        WHERE is_ai_classified = 0;
    </select>

    <!-- 更新AI分类相关字段 -->
    <update id="updateAiCategoryInfo">
        UPDATE tender_project_detail_parsed
        SET is_ai_classified = #{isAiClassified},
            ai_classify_time = #{aiClassifyTime},
            category_code = #{categoryCode},
            updated_time = NOW()
        WHERE id = #{id}
    </update>

</mapper>
